{% extends "base.html" %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/teleconsultation.css') }}">
{% endblock %}

{% block content %}

<!-- HERO -->
<section class="tele-hero">
  <div class="tele-hero__bg">
    <div class="tele-hero__gradient"></div>
    <div class="tele-hero__grid"></div>
  </div>
  <div class="tele-hero__content container">
    <h1 class="tele-hero__title">Secure <span>Teleconsultation</span></h1>
    <p class="tele-hero__subtitle">Book, pay, and meet your doctor from anywhere — frictionless, private, and professional.</p>
    <div class="tele-hero__badges">
      <span class="badge">HIPAA-Inspired Privacy</span>
      <span class="badge">Encrypted Links</span>
      <span class="badge">One-Click Join</span>
    </div>
  </div>
</section>

<!-- PROGRESS STEPS -->
<nav class="steps container" aria-label="Teleconsultation steps">
  <button class="step is-active" data-step="1">1 · Sign In</button>
  <button class="step" data-step="2">2 · Book</button>
  <button class="step" data-step="3">3 · Pay</button>
  <button class="step" data-step="4">4 · Join</button>
  <div class="steps__bar"><span class="steps__progress" style="width:25%"></span></div>
</nav>

<!-- MAIN -->
<section class="tele container">

  <!-- LEFT COLUMN -->
  <div class="tele__left">

    <!-- AUTH / PROVIDERS -->
    <article class="card card--auth" aria-labelledby="authTitle">
      <div class="card__head">
        <h2 id="authTitle">Get Started</h2>
        <p class="sub">Sign in to continue your secure teleconsultation</p>
      </div>

      <div class="providers">
        <button id="googleSignInBtn" class="provider provider--google" type="button">
          <img src="{{ url_for('static', filename='images/google_icon2.png') }}" alt="" class="provider__icon">
          Continue with Google
        </button>

        <button id="zoomSignInBtn" class="provider provider--zoom" type="button">
          <img src="{{ url_for('static', filename='images/zoom.png') }}" alt="" class="provider__icon">
          Continue with Zoom
        </button>

        <p class="provider__hint">Signed-out users will be redirected to <strong>login.html</strong>.</p>
        <div class="auth-status" id="authStatus" aria-live="polite">Checking sign-in…</div>
      </div>
    </article>

    <!-- BOOKING FORM -->
    <article class="card" aria-labelledby="bookTitle">
      <div class="card__head">
        <h2 id="bookTitle">Book Consultation</h2>
        <p class="sub">Pick a slot and share your details</p>
      </div>

      <form id="teleForm" class="form" novalidate>
        <div class="form__row">
          <div class="field">
            <label class="label">Date</label>
            <input type="date" id="consultDate" required class="input">
            <small class="hint" id="dateHint"></small>
          </div>
          <div class="field">
            <label class="label">Time</label>
            <select id="consultTime" required class="input">
              <option value="">— Select —</option>
              <option>09:00</option>
              <option>09:30</option>
              <option>10:00</option>
              <option>10:30</option>
              <option>11:00</option>
              <option>11:30</option>
              <option>12:00</option>
              <option>12:30</option>
              <option>13:00</option>
              <option>13:30</option>
              <option>14:00</option>
              <option>14:30</option>
              <option>15:00</option>
              <option>15:30</option>
              <option>16:00</option>
              <option>16:30</option>
            </select>
            <small class="hint">Timezone: <span id="tz"></span></small>
          </div>
        </div>

        <div class="form__row">
          <div class="field">
            <label class="label">Full Name</label>
            <input type="text" id="fullName" required class="input" placeholder="e.g., John Doe">
          </div>
          <div class="field">
            <label class="label">Email</label>
            <input type="email" id="email" required class="input" placeholder="you@example.com">
          </div>
        </div>

        <div class="form__row">
          <div class="field">
            <label class="label">Phone</label>
            <input type="tel" id="phone" required class="input" placeholder="+234…">
          </div>
          <div class="field">
            <label class="label">Special Request (Optional)</label>
            <input type="text" id="notes" class="input" placeholder="Allergies, translator, etc.">
          </div>
        </div>

        <div class="form__actions">
          <button type="button" id="suggestBtn" class="btn btn--ghost">💡 Suggest Best Time</button>
          <button type="button" id="deviceTestBtn" class="btn btn--ghost">🔧 Device Check</button>
          <div class="spacer"></div>
          <button type="button" id="teleBookBtn" class="btn btn--primary">Confirm &amp; Pay</button>
        </div>

        <p class="notice">🔒 Payment is required to unlock your meeting link.</p>
      </form>
    </article>

    <!-- HINTS -->
    <article class="card card--mini">
      <div class="card__list">
        <div class="list-item">✅ Auto-email with join link after payment</div>
        <div class="list-item">✅ Add to Calendar (.ics)</div>
        <div class="list-item">✅ Reschedule up to 12 hours prior</div>
      </div>
    </article>
  </div>

  <!-- RIGHT COLUMN -->
  <div class="tele__right">

    <!-- MEETING PREVIEW -->
    <article class="card card--video" aria-labelledby="previewTitle">
      <div class="card__head">
        <h2 id="previewTitle">Meeting Preview</h2>
        <p class="sub">Locked until payment • Controls shown for preview</p>
      </div>

      <div class="stage-wrap">
        <div class="stage-toolbar">
          <div class="zoom-controls" role="group" aria-label="Zoom controls">
            <button class="icon-btn" id="zoomOut" title="Zoom out">−</button>
            <button class="icon-btn" id="zoomReset" title="Reset zoom">100%</button>
            <button class="icon-btn" id="zoomIn" title="Zoom in">+</button>
          </div>
          <span class="pill pill--locked">Locked</span>
        </div>

        <div class="stage" id="previewStage" aria-label="Video grid">
          <div class="tile">
            <div class="avatar">JD</div>
            <div class="tile__name">You</div>
          </div>
          <div class="tile tile--ghost">
            <div class="avatar avatar--ghost">DR</div>
            <div class="tile__name">Doctor</div>
          </div>
          <div class="tile tile--ghost">
            <div class="avatar avatar--ghost">AS</div>
            <div class="tile__name">Assistant</div>
          </div>
          <div class="tile tile--ghost">
            <div class="avatar avatar--ghost">INT</div>
            <div class="tile__name">Interpreter</div>
          </div>
        </div>

        <div class="controls">
          <button class="control" disabled aria-disabled="true">🎤</button>
          <button class="control" disabled aria-disabled="true">📷</button>
          <button class="control" disabled aria-disabled="true">🖥️</button>
          <button class="control" disabled aria-disabled="true">⏺</button>
          <button class="control control--cta" disabled aria-disabled="true">Join (Locked)</button>
        </div>
      </div>
    </article>

    <!-- SUPPORT -->
    <article class="card card--mini">
      <div class="card__list">
        <div class="list-item">💬 Live Chat (9am–5pm)</div>
        <div class="list-item">📧 support@epiconsult.example</div>
        <div class="list-item">📄 Refund &amp; Reschedule Policy</div>
      </div>
    </article>
  </div>

</section>

<!-- SUMMARY MODAL -->
<div id="teleSummaryModal" class="modal" aria-hidden="true" role="dialog" aria-labelledby="summaryTitle">
  <div class="modal__dialog">
    <div class="modal__head">
      <h3 id="summaryTitle">Confirm Teleconsultation</h3>
      <button class="modal__close" id="teleCancelBtn" aria-label="Close">✕</button>
    </div>
    <div id="teleSummaryContent" class="modal__content"></div>
    <div class="modal__actions">
      <button id="teleEditBtn" class="btn btn--ghost">Edit</button>
      <button id="teleConfirmBtn" class="btn btn--primary">Proceed to Payment</button>
    </div>
  </div>
</div>

<!-- DEVICE CHECK MODAL -->
<div id="deviceModal" class="modal" aria-hidden="true" role="dialog" aria-labelledby="deviceTitle">
  <div class="modal__dialog">
    <div class="modal__head">
      <h3 id="deviceTitle">Device &amp; Network Check</h3>
      <button class="modal__close" id="deviceCloseBtn" aria-label="Close">✕</button>
    </div>
    <div class="modal__content">
      <ul class="checklist" id="deviceChecklist">
        <li>🎤 Microphone permission <span class="status" data-key="mic">…</span></li>
        <li>📷 Camera permission <span class="status" data-key="cam">…</span></li>
        <li>🌐 Network quality <span class="status" data-key="net">…</span></li>
        <li>🖥️ Screen share support <span class="status" data-key="share">…</span></li>
      </ul>
    </div>
    <div class="modal__actions">
      <button id="deviceRunBtn" class="btn btn--primary">Run Check</button>
    </div>
  </div>
</div>

<!-- TOASTS -->
<div id="toastRegion" class="toast-region" aria-live="polite" aria-atomic="true"></div>

{% endblock %}

{% block scripts %}
<script type="module" src="{{ url_for('static', filename='js/teleconsultation.js') }}"></script>
{% endblock %}
