{% extends "base.html" %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/lab.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/lab_card.css') }}">
{% endblock %}

{% block content %}

<!-- HERO -->
<section class="relative h-[50vh] overflow-hidden">
  <div class="relative h-full">
    <img src="{{ url_for('static', filename='images/lab/1.jpg') }}"
         alt="Modern Medical Laboratory"
         class="absolute inset-0 w-full h-full object-cover" />
    <div class="absolute inset-0 bg-gradient-to-r from-navy/80 via-black/50 to-transparent"></div>

    <!-- Text Overlay -->
    <div class="absolute inset-0 flex items-center">
      <div class="container mx-auto px-6">
        <div class="max-w-3xl text-white animate-fadeInUp">
          <h1 class="text-5xl md:text-6xl font-bold mb-6 leading-tight">
            Explore Our <span class="text-red-500">Laboratory</span> Services
          </h1>
          <p class="text-xl text-gray-200 leading-relaxed mb-6">
            Accurate diagnostics across <span class="font-bold">Blood</span>, 
            <span class="font-bold">Urine</span>, <span class="font-bold">Stool</span>, 
            <span class="font-bold">Virology</span>, <span class="font-bold">Endocrine</span> 
            and more.
          </p>
          <button onclick="scrollToBooking()" 
                  class="book-btn px-8 py-3 rounded-full text-lg shadow-lg">
            📅 Book a Test
          </button>
        </div>
      </div>
    </div>
  </div>
</section>


<!-- Global Search -->
<section class="bg-gray-50 py-10">
  <div class="max-w-4xl mx-auto text-center">
    <input id="global-search" type="text" placeholder="🔍 Search for any test (type ≥ 3 letters)..."
           class="w-full p-4 border rounded-xl focus:ring-2 focus:ring-red-500" />
  </div>
  <div id="global-results" class="hidden max-w-4xl mx-auto mt-6 grid sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
</section>



<!-- Services -->
<!-- Services -->
<section class="py-20 bg-gray-50">
  <div class="max-w-7xl mx-auto px-6 lg:px-8 text-center">
    <h2 class="text-4xl font-bold text-navy mb-12">
      Our <span class="text-red-600">Services</span>
    </h2>

    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-10">

      {% set lab_cards = [
        ("🩸", "Blood Tests", "blood"),
        ("🧃", "Urine Tests", "urine"),
        ("🧪", "Stool Tests", "stool"),
        ("🧫", "Microbiology & Cultures", "microbiology"),
        ("🧬", "Histology & Cytology", "histology"),
        ("🦠", "Virology", "virology"),
        ("🛡️", "Immunology & Autoimmune", "immunology"),
        ("🎯", "Tumor Markers", "tumor"),
        ("⚖️", "Hormonal & Endocrine", "hormonal"),
        ("📊", "Hematology Investigations", "hematology"),
        ("🏥", "Blood Bank Services", "bloodbank"),
        ("🌿", "Allergy Panels", "allergy"),
        ("🍬", "Diabetic Profile", "diabetic"),
        ("💧", "Kidney Function Test", "kidney"),
        ("❤️", "Cardiac Marker Test", "cardiac"),
        ("🍷", "Liver Function Test", "liver"),
        ("🥼", "Pancreatic Function Test", "pancreatic"),
        ("🦴", "Bone Profile", "bone"),
        ("👶", "Fertility Profile", "fertility"),
        ("🤰", "Miscarriage Profile", "miscarriage"),
        ("🧻", "Infection Screening", "infection"),
        ("🩹", "Clotting Profile", "clotting")
      ] %}
      {% for icon, title, key in lab_cards %}
      <div class="special-card zoom-effect bg-white text-navy p-8 rounded-2xl shadow-lg">
        <div class="text-5xl mb-6">{{ icon }}</div>
        <h3 class="text-2xl font-bold mb-4">{{ title }}</h3>
        <p class="mb-6 text-gray-600">View available diagnostic tests under {{ title }}.</p>
        <button onclick="openCategory('{{ key }}')" 
                class="book-btn px-6 py-3 rounded-lg">
          Explore
        </button>
      </div>
      {% endfor %}
    </div>
  </div>
</section>


<!-- Service Modal -->
<div id="serviceModal" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50">
  <div class="modal-content rounded-2xl shadow-2xl w-full md:w-3/4 lg:w-1/2 p-8 opacity-0 scale-95 transition-all duration-300 bg-white">
    <h3 id="modalTitle" class="text-2xl font-bold mb-6 text-navy"></h3>
    <div id="serviceList" class="grid grid-cols-2 md:grid-cols-3 gap-6"></div>
    <div class="mt-6 flex justify-end">
      <button id="closeModalBtn"
              class="bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 transition">
        Close
      </button>
    </div>
  </div>
</div>

<!-- Booking Modal -->
<div id="bookingModal" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50">
  <div class="modal-content rounded-2xl shadow-2xl w-96 p-8 opacity-0 scale-95 transition-all duration-300 bg-white">
    <h3 id="bookingTitle" class="text-xl font-bold mb-4 text-navy"></h3>
    <p class="mb-6 text-gray-600">
      Book this test now. Confirmation and payment details will be shared.
    </p>
    <div class="flex justify-end gap-3">
      <button id="confirmBookingBtn"
              class="book-btn px-6 py-3 rounded-lg bg-green-600 text-white hover:bg-green-700 transition">
        Book Now
      </button>
      <button id="closeBookingBtn"
              class="bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 transition">
        Cancel
      </button>
    </div>
  </div>
</div>

<!-- Sample Collection CTA -->
<section class="relative overflow-hidden py-20 bg-gradient-to-r from-navy to-navy/95 text-white">
  <div class="absolute inset-0 opacity-10 bg-[radial-gradient(circle_at_top_left,white,transparent_40%)]"></div>
  <div class="relative max-w-6xl mx-auto px-6 lg:px-8 grid md:grid-cols-2 gap-12 items-center">
    <div>
      <h3 class="text-3xl font-bold mb-4">Home & Office Sample Collection</h3>
      <p class="text-gray-100 mb-6">We bring the lab to your doorstep. Reliable, fast, and secure sample pickup.</p>
      <ul class="space-y-2 text-gray-200 mb-6 list-disc list-inside">
        <li>Same-day pickup</li>
        <li>Cold chain maintained</li>
        <li>Digital reports delivery</li>
      </ul>
      <button onclick="scrollToBooking()" class="book-btn px-8 py-3 rounded-full">Schedule Pickup</button>
    </div>
    <div class="bg-white/10 backdrop-blur-md p-8 rounded-2xl border border-white/20">
      <div class="grid grid-cols-2 gap-6 text-center">
        <div><p class="text-sm text-gray-300">Avg Pickup</p><p class="text-2xl font-bold">&lt; 90m</p></div>
        <div><p class="text-sm text-gray-300">Coverage</p><p class="text-2xl font-bold">Citywide</p></div>
        <div><p class="text-sm text-gray-300">Cold Chain</p><p class="text-2xl font-bold">✔</p></div>
        <div><p class="text-sm text-gray-300">Cutoff</p><p class="text-2xl font-bold">3 PM</p></div>
      </div>
    </div>
  </div>
</section>

<!-- Booking Form -->
<section id="book-lab" class="py-20 bg-gray-50">
  <div class="max-w-6xl mx-auto px-6 lg:px-10 grid lg:grid-cols-3 gap-10 items-start">
    
    <!-- Booking Form -->
    <div class="lg:col-span-2 bg-white text-navy rounded-2xl shadow-2xl p-10 relative overflow-hidden">
      
      <!-- Progress Bar -->
      <div class="flex items-center justify-between mb-10 relative">
        <div class="flex-1 flex items-center">
          <div class="step active">
            <div class="circle">1</div>
            <p class="text-sm font-semibold mt-2">Personal Info</p>
          </div>
          <div class="line"></div>
        </div>
        <div class="flex-1 flex items-center">
          <div class="step">
            <div class="circle">2</div>
            <p class="text-sm font-semibold mt-2">Category</p>
          </div>
          <div class="line"></div>
        </div>
        <div class="flex-1 flex items-center">
          <div class="step">
            <div class="circle">3</div>
            <p class="text-sm font-semibold mt-2">Select Test</p>
          </div>
          <div class="line"></div>
        </div>
        <div class="step">
          <div class="circle">4</div>
          <p class="text-sm font-semibold mt-2">Confirm</p>
        </div>
      </div>

      <h2 class="text-3xl font-bold mb-6">Book Your <span class="text-red-600">Test</span></h2>
      <form id="lab-booking-form" method="POST" action="#" class="space-y-8">

        <!-- Step 1: Personal Info -->
        <div class="grid md:grid-cols-2 gap-6">
          <div>
            <label class="block text-sm font-semibold mb-1">Full Name</label>
            <input type="text" name="name" required class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-red-500">
          </div>
          <div>
            <label class="block text-sm font-semibold mb-1">Email</label>
            <input type="email" name="email" required class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-red-500">
          </div>
        </div>

        <!-- Step 2: Category -->
        <div>
          <label class="block text-sm font-semibold mb-1">Category</label>
          <select id="booking-category" name="category" required
                  class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-red-500">
            <option value="">-- Select Category --</option>
            <!-- options will now be injected dynamically by JS -->
          </select>
        </div>

<!-- Step 3: Test Selector (hidden until category selected) -->
<div id="test-selector" class="hidden">
  <label class="block text-sm font-semibold mb-1">Specific Test</label>
  <div class="flex items-center gap-2">
    <input id="booking-test-input"
           type="text"
           placeholder="Search or select a test..."
           class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-red-500" />
  </div>
  <select id="booking-test" name="test" class="hidden">
    <option value="">-- Select Test --</option>
  </select>
</div>


        <!-- Step 3.5: Global Search -->
        <div>
          <label class="block text-sm font-semibold mb-1">🔍 Search Any Test</label>
          <input id="search-tests" type="text" placeholder="Type at least 3 letters..." class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-red-500">
        </div>

        <!-- Step 4: Date -->
        <div>
          <label class="block text-sm font-semibold mb-1">Preferred Date</label>
          <div class="relative">
            <input type="date" name="date" required class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-red-500">
            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400">📅</span>
          </div>
        </div>

        <!-- Submit + Clear -->
        <div class="text-center pt-6 flex flex-col sm:flex-row justify-center gap-4">
          <button type="submit"
            class="px-10 py-4 text-lg rounded-full text-white font-semibold transition hover:opacity-90 bg-red-600">
            🚀 Confirm Booking
          </button>
          <button type="button" id="clear-booking"
            class="hidden px-10 py-4 text-lg rounded-full text-white font-semibold transition hover:opacity-90 bg-gray-500">
            🔄 Clear
          </button>
        </div>

        <p class="text-sm text-gray-500 mt-4 text-center">
          ✔ Secure Booking • ⚡ Fast Results • 📧 Instant Confirmation
        </p>
      </form>
    </div>

    <!-- Live Summary Sidebar -->
    <div class="bg-white text-navy rounded-2xl shadow-xl p-8 space-y-6">
      <h3 class="text-xl font-bold">Booking Summary</h3>
      <div class="border-t pt-4 space-y-3">
        <p><span class="font-semibold">Name:</span> <span id="summary-name" class="text-gray-600">-</span></p>
        <p><span class="font-semibold">Email:</span> <span id="summary-email" class="text-gray-600">-</span></p>
        <p><span class="font-semibold">Category:</span> <span id="summary-category" class="text-gray-600">-</span></p>
        <p><span class="font-semibold">Test:</span> <span id="summary-test" class="text-gray-600">-</span></p>
        <p><span class="font-semibold">Date & Time:</span> <span id="summary-datetime" class="text-gray-600">-</span></p>
      </div>
      <div class="bg-gray-100 p-4 rounded-lg text-sm">
        <p>📢 <span class="font-semibold">Note:</span> You’ll receive instructions & payment details by email.</p>
      </div>
    </div>
  </div>
</section>

{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/lab.js') }}"></script>
<script src="{{ url_for('static', filename='js/lab_data.js') }}"></script>
<script src="{{ url_for('static', filename='js/lab_search.js') }}"></script>
{% endblock %}
